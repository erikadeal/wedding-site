/*!CK:3184694996!*//*1417473983,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["9\/QKg"]); }

__d("P2PPaymentLogMessageSubtype",[],function(a,b,c,d,e,f){e.exports={CANCELED_SENDER_RISK:"canceled_sender_risk",CANCELED_DECLINED:"canceled_declined",CANCELED_RECIPIENT_RISK:"canceled_recipient_risk",CANCELED_EXPIRED:"canceled_expired"};},null);
__d("EmployeePrefs",["Dock","DOM","Event","Keys","MenuDeprecated","NubController","Parent","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){for(var o in l)if(l.hasOwnProperty(o))q[o]=l[o];var p=l===null?null:l.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=l;function q(){"use strict";if(l!==null)l.apply(this,arguments);}q.prototype.init=function(r,s){"use strict";p.init.call(this,r);this.menu=s;g.registerNubController(r,this);i.listen(r,'keydown',function(event){var t=i.getKeyCode(event)||event.which;switch(t){case j.UP:case j.DOWN:var u=m.byClass(event.getTarget(),'fbNubButton');if(u){this.show();var v=k.getItems(s);k.focusItem(v[t===j.UP?v.length-1:0]);return false;}break;case j.ESC:this.hide();setTimeout(function(){h.find(r,'a.fbNubButton').focus();},0);break;}}.bind(this));this.subscribe('show',this.onShow.bind(this));this.subscribe('hide',this.onHide.bind(this));this.buttonContentChanged();};q.prototype.onShow=function(){"use strict";k.register(this.menu);};q.prototype.onHide=function(){"use strict";k.unregister(this.menu);};q.prototype.getSamePageURLOnNewTier=function(r,s){"use strict";if(s==='sandbox'){var t=r.getUnqualifiedURI().toString().substr(1);return n(r.getProtocol()+'://bunnylol.facebook.net/?sandbox'+(t===''?'':'+'+encodeURIComponent(t)));}else{var u='www'+(s?('.'+s):'')+'.facebook.com';return n().setProtocol(r.getProtocol()).setDomain(u).setSubdomain(r.getSubdomain()).setPath(r.getPath()).setQueryData(r.getQueryData()).setFragment(r.getFragment());}};q.prototype.goToTier=function(r){"use strict";top.location.href=this.getSamePageURLOnNewTier(n.getRequestURI(),r);return false;};e.exports=q;},null);
__d("insertEmoticonIntoContentState",["DocumentModifierExperimental","applyEmoticonToContentBlock"],function(a,b,c,d,e,f,g,h){"use strict";function i(j,k,l){var m=g.replaceText(k,l,j),n=l.getAnchorKey(),o=l.getAnchorOffset(),p=m.getBlockForKey(n),q=m.getBlockMap().set(n,h(p,j,o));o++;return k.merge({blockMap:q,selectionBefore:l,selectionAfter:l.merge({anchorOffset:o,focusOffset:o})});}e.exports=i;},null);
__d("StickerTriggerHighlightSpan.react",["EmoticonSpan.react","React","Toggler","cx"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=h.createClass({displayName:"StickerTriggerHighlightSpan",getInitialState:function(){return {activated:false};},propTypes:{offsetKey:h.PropTypes.string,searchTriggeredWord:h.PropTypes.func,stickersFlyoutToggler:h.PropTypes.object},componentDidMount:function(){this._togglerSub=i.listen('hide',this.props.stickersFlyoutToggler,function(){return this.isMounted()&&this.setState({activated:false});}.bind(this));},componentWillUnmount:function(){this._togglerSub&&this._togglerSub.unsubscribe();},_onClick:function(){if(this.state.activated)return;this.props.searchTriggeredWord();this.setState({activated:true});},render:function(){var l;if(this.props.entityKey){l=h.createElement(g,h.__spread({},this.props));}else l=this.props.children;return (h.createElement("span",{onClick:this._onClick,"data-offset-key":this.props.offsetKey,className:(("_29dt")+(this.state.activated?' '+"_1t57":'')),spellCheck:false},l));}});e.exports=k;},null);
__d("ChatInput.react",["AbstractMentionsTextEditor.Experimental.react","Bootloader","ChatConfig","ComposedEntityType","DocumentCompositeDecorator.Experimental","DocumentDecorator","DocumentModifierExperimental","EditorChangeType","EditorState","EmoticonSpan.react","MentionSpan.react","MentionsInputTypeaheadView.react","MentionsLayer.react","StickerTriggerHighlightSpan.react","React","createContentStateFromBlocks","createInitialEditorState","createMentionEntity","createPlainBlocksFromText","emptyFunction","getDefaultKeyBinding","getEntityMatcherExperimental","getVisibleValueForContentState","handleBeforeInputForEmoticon","handleSoftNewlineForEmoticon","insertEmoticonIntoContentState","isSoftNewlineEvent","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){"use strict";var ia=z.thatReturnsNull,ja=j.EMOTICON,ka=j.MENTION,la=' ',ma=u.createClass({displayName:"ChatInput",propTypes:{blockStyleFn:u.PropTypes.func,initializeThingsWithInputFn:u.PropTypes.func,inlineStyleFn:u.PropTypes.func,inputChanged:u.PropTypes.func,inputKeyDown:u.PropTypes.func,keyBindingFn:u.PropTypes.func,onAddMention:u.PropTypes.func,onBlur:u.PropTypes.func,onEscape:u.PropTypes.func,onFocus:u.PropTypes.func,onTab:u.PropTypes.func,resizeFn:u.PropTypes.func,searchTriggeredWord:u.PropTypes.func,stickersFlyoutToggler:u.PropTypes.object},getDefaultProps:function(){return {blockStyleFn:ia,inlineStyleFn:ia,keyBindingFn:aa};},componentDidMount:function(){this._oldHeight=this.getDOMNode().getBoundingClientRect().height;this.props.resizeFn(this._oldHeight);this.props.initializeThingsWithInputFn(this.refs.input.getDOMNode(),this.getValue);this.setState({triggeredWord:this.props.triggeredWord});if(i.get('chat_mentions_entities'))h.loadModules(["AtSignMentionsStrategy","CurrentUser","DocumentCompositeMentionsSource","DocumentMentionsSource","SearchSourceWithMetrics","TypeaheadMetricReporter","URI","WebAsyncSearchSource"],function(na,oa,pa,qa,ra,sa,ta,ua){var va=new sa({event_name:'chat_mentions_entities'}),wa=new ra(new ua({queryRequests:[{uri:ta('/ajax/typeahead/search.php'),data:{viewer:oa.getID(),filter:i.get('chat_mentions_types')}}],bootstrapRequests:[{uri:ta('/ajax/typeahead/first_degree.php'),data:{viewer:oa.getID(),filter:i.get('chat_mentions_types')}}]}),va),xa=new pa([new qa(na,wa)]);xa.bootstrap();va.sessionStart();this.setState({mentionsSource:xa,typeaheadReporter:va});}.bind(this));},componentWillReceiveProps:function(na){if(this.state.triggeredWord!==na.triggeredWord)this.setState({triggeredWord:na.triggeredWord},this._updateDecorator);},componentDidUpdate:function(){ha(function(){var na=this.getDOMNode().getBoundingClientRect().height;if(this._oldHeight!==na)this.props.resizeFn(na);this._oldHeight=na;}.bind(this));},getInitialState:function(){return {editorState:this._createEmptyEditorState()};},_createEmptyEditorState:function(){var na=y(['']);return w(v(na),this._getStickerTagDecorator());},resetState:function(){if(this.state.typeaheadReporter){this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}this.setState({editorState:o.moveFocusToEnd(this._createEmptyEditorState()),triggeredWord:null});},_updateDecorator:function(){var na=this._getStickerTagDecorator();ha(function(){var oa=o.set(this.state.editorState,{decorator:na});this.setState({editorState:oa});}.bind(this));},_getStickerTagDecorator:function(){var na=this.state&&this.state.triggeredWord,oa=function(qa,ra){if(!na)return;var sa,ta,ua;if(na.match(/\W/)){ua=new RegExp(na.replace(/(\W)/g,'\\$1'),'gi');}else ua=new RegExp('\\b'+na+'\\b','gi');while((sa=ua.exec(qa.getText()))!==null){ta=sa.index;ra(ta,ta+na.length);}},pa={stickersFlyoutToggler:this.props.stickersFlyoutToggler,searchTriggeredWord:this.props.searchTriggeredWord};return new k([new l(oa,t,pa),new l(ba(function(qa){return (qa.getType()===ja&&qa.getData().originalEmoticon===na);}),t,pa),new l(ba(function(qa){return qa.getType()===ja;}),p),new l(ba(function(qa){return qa.getType()===ka;}),q)]);},onChange:function(na){if(na.getCurrentContent()!==this.state.editorState.getCurrentContent())this.props.inputChanged(this.getValueFromEditorState(na));this.setState({editorState:na});},onReturn:function(event){if(ga(event)){var na=ea(this.state.editorState);if(na===this.state.editorState)return false;this.setState({editorState:na});return true;}this.props.inputKeyDown(event,this.getValue());this.resetState();return true;},_onAddMention:function(na){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportSelect(na.getUniqueID(),na.getType(),0,false);this.props.onAddMention&&this.props.onAddMention(na);},_onShowMentions:function(na,oa){this.state.typeaheadReporter&&this.state.typeaheadReporter.reportResults(na.map(function(pa){return pa.getUniqueID();}));},getValueFromEditorState:function(na){var oa=na.getCurrentContent();return ca(oa);},getValue:function(){return this.getValueFromEditorState(this.state.editorState);},focus:function(){this.refs.input.focus();},_handleBeforeInput:function(na){var oa=da(this.state.editorState,na);if(oa===this.state.editorState)return false;this.setState({editorState:oa});return true;},_handleFiles:function(na){var oa=/^image\//,pa=na.filter(function(qa){return oa.test(qa.type);});if(pa.length){this.props.uploadPhotoFn(pa[0]);return true;}return false;},_handlePastedFiles:function(na){return this._handleFiles(na);},_handleDroppedFiles:function(na,oa){return this._handleFiles(oa);},insertEmoticon:function(na){var oa=this.state.editorState,pa=oa.getSelection(),qa=oa.getCurrentContent(),ra=pa.getStartOffset(),sa=pa.getEndOffset(),ta=qa.getBlockForKey(pa.getStartKey()).getText(),ua=qa.getBlockForKey(pa.getEndKey()).getText(),va='';if(sa<=ua.length&&ua[sa]!==la)va=la;if(ra>0&&ta[ra-1]!==la){qa=m.insertText(qa,pa,la);pa=qa.getSelectionAfter();}var wa=fa(na,qa,pa);qa=m.insertText(wa,wa.getSelectionAfter(),va);oa=o.push(oa,qa,n.INSERT_CHARACTERS);if(oa!==this.state.editorState)this.setState({editorState:oa});},appendText:function(na){var oa=this.state.editorState,pa=oa.getSelection(),qa=oa.getCurrentContent();qa=m.insertText(qa,pa,na);oa=o.push(oa,qa,n.INSERT_CHARACTERS);this.setState({editorState:oa});},render:function(){return (u.createElement(g,u.__spread({ref:"input"},this.props,{editorState:this.state.editorState,onChange:this.onChange,onAddMention:this._onAddMention,onShowMentions:this._onShowMentions,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,handleContentReturn:this.onReturn,spellCheck:true,mentionCreationFn:x,mentionResultsComponent:s,mentionResultsProps:{typeaheadView:r,autoflip:true},mentionsSource:this.state.mentionsSource})));}});e.exports=ma;},null);